<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥ TCLDCAM - æ™ºèƒ½åµæ¸¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; min-height: 100vh; padding: 10px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; padding: 20px 0; }
        .logo { font-size: 3em; margin-bottom: 10px; }
        .title { font-size: 2em; margin-bottom: 10px; }
        .nav { display: flex; background: rgba(255,255,255,0.1); border-radius: 25px; padding: 5px; margin: 20px 0; }
        .nav-item { flex: 1; text-align: center; padding: 12px; border-radius: 20px; cursor: pointer; font-size: 0.9em; }
        .nav-item.active { background: rgba(255,255,255,0.2); }
        .content { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; min-height: 300px; }
        .btn { background: #ff6b6b; border: none; border-radius: 25px; padding: 15px 30px; color: white; cursor: pointer; font-size: 1.1em; margin: 10px; }
        .btn:hover { background: #ff5252; }
        .btn.active { background: #ff4757; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .status { background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; margin: 15px 0; }
        .row { display: flex; justify-content: space-between; margin: 8px 0; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .card { background: rgba(255,255,255,0.1); border-radius: 10px; padding: 20px; text-align: center; }
        .icon { font-size: 2em; display: block; margin-bottom: 10px; }
        .hidden { display: none; }
        /* æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        @media (max-width: 768px) {
            .container { padding: 5px; }
            .header { padding: 15px 0; }
            .logo { font-size: 2.5em; }
            .title { font-size: 1.8em; }
            .nav { flex-direction: column; padding: 3px; }
            .nav-item { margin: 3px 0; padding: 15px; font-size: 1em; }
            .content { padding: 15px; min-height: 250px; }
            .btn { padding: 12px 25px; font-size: 1em; margin: 8px; }
            .status { padding: 12px; }
            .row { flex-direction: column; text-align: center; margin: 12px 0; }
            .grid { grid-template-columns: 1fr; gap: 10px; }
            .card { padding: 15px; }
        }
        
        @media (max-width: 480px) {
            .container { padding: 3px; }
            .header { padding: 10px 0; }
            .logo { font-size: 2em; }
            .title { font-size: 1.5em; }
            .nav-item { padding: 12px; font-size: 0.9em; }
            .content { padding: 10px; }
            .btn { padding: 10px 20px; font-size: 0.9em; }
            .card { padding: 12px; }
        }
        
        /* è§¸æ§å„ªåŒ– */
        .nav-item, .btn {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        /* é˜²æ­¢ç¸®æ”¾ */
        input[type="range"], input[type="checkbox"], select {
            -webkit-appearance: none;
            touch-action: manipulation;
        }
        
        input[type="range"] {
            height: 30px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            border: 2px solid white;
        }
        
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            border-radius: 4px;
            position: relative;
        }
        
        input[type="checkbox"]:checked {
            background: #27ae60;
        }
        
        input[type="checkbox"]:checked::after {
            content: 'âœ“';
            position: absolute;
            top: -2px;
            left: 2px;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        select {
            padding: 10px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 8px;
            font-size: 16px; /* é˜²æ­¢iOSç¸®æ”¾ */
        }
        
        select option {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ğŸ¥</div>
            <h1 class="title">TCLDCAM</h1>
            <p>æ™ºèƒ½è²éŸ³èˆ‡è¦–è¦ºåµæ¸¬</p>
        </div>
        
        <div class="nav">
            <div class="nav-item active" onclick="show('home')">ğŸ  ä¸»é </div>
            <div class="nav-item" onclick="show('settings')">âš™ï¸ è¨­å®š</div>
            <div class="nav-item" onclick="show('files')">ğŸ“ æª”æ¡ˆ</div>
            <div class="nav-item" onclick="show('models')">ğŸ¤– æ¨¡å‹</div>
        </div>
        
        <div id="home" class="content">
            <h2 style="text-align: center; margin-bottom: 20px;">ğŸ¯ åµæ¸¬æ§åˆ¶</h2>
            <div style="text-align: center;">
                <button id="recordBtn" class="btn" onclick="toggle()">ğŸ¤ é–‹å§‹åµæ¸¬</button>
            </div>
            
            <div class="status">
                <div class="row"><span>ğŸ“Š ç‹€æ…‹:</span><span id="status">å¾…æ©Ÿä¸­</span></div>
                <div class="row"><span>ğŸµ éŸ³é‡:</span><span id="volume">0 dB</span></div>
                <div class="row"><span>ğŸ‘ï¸ è¦–è¦º:</span><span id="visual">æœªå•Ÿå‹•</span></div>
                <div class="row"><span>â±ï¸ æ™‚é–“:</span><span id="time">00:00</span></div>
            </div>
            
            <div class="grid">
                <div class="card">
                    <span class="icon">ğŸµ</span>
                    <h3>è²éŸ³åµæ¸¬</h3>
                    <p>æ™ºèƒ½è­˜åˆ¥ç‰¹å®šè²éŸ³æ¨¡å¼</p>
                </div>
                <div class="card">
                    <span class="icon">ğŸ‘ï¸</span>
                    <h3>è¦–è¦ºåµæ¸¬</h3>
                    <p>AIé©…å‹•çš„ç•«é¢åˆ†æ</p>
                </div>
                <div class="card">
                    <span class="icon">ğŸ“¹</span>
                    <h3>è‡ªå‹•éŒ„è£½</h3>
                    <p>åµæ¸¬åˆ°ç›®æ¨™æ™‚è‡ªå‹•éŒ„è£½</p>
                </div>
                <div class="card">
                    <span class="icon">ğŸ¤–</span>
                    <h3>AIæ¨¡å‹</h3>
                    <p>é›²ç«¯æ›´æ–°èˆ‡æœ¬åœ°ç·©å­˜</p>
                </div>
            </div>
        </div>
        
        <div id="settings" class="content hidden">
            <h2 style="text-align: center; margin-bottom: 20px;">âš™ï¸ åµæ¸¬è¨­å®š</h2>
            <div class="status">
                <h3>ğŸµ è²éŸ³åµæ¸¬è¨­å®š</h3>
                <div class="row"><span>åµæ¸¬é–¾å€¼:</span><span id="audioThresholdValue">50 dB</span></div>
                <input type="range" id="audioThresholdSlider" style="width: 100%; margin: 10px 0;" min="0" max="100" value="50" oninput="updateAudioThreshold(this.value)">
                
                <div class="row"><span>æŒçºŒæ™‚é–“:</span><span id="audioDurationValue">2 ç§’</span></div>
                <input type="range" id="audioDurationSlider" style="width: 100%; margin: 10px 0;" min="1" max="10" value="2" oninput="updateAudioDuration(this.value)">
                
                <div class="row">
                    <span>è‡ªå‹•è§¸ç™¼:</span>
                    <input type="checkbox" id="audioAutoTrigger" checked onchange="updateAudioAutoTrigger(this.checked)">
                    <span id="audioAutoStatus">âœ… å•Ÿç”¨</span>
                </div>
                
                <h3 style="margin-top: 20px;">ğŸ‘ï¸ è¦–è¦ºåµæ¸¬è¨­å®š</h3>
                <div class="row"><span>éˆæ•åº¦:</span><span id="visualSensitivityValue">ä¸­ç­‰</span></div>
                <input type="range" id="visualSensitivitySlider" style="width: 100%; margin: 10px 0;" min="0" max="100" value="50" oninput="updateVisualSensitivity(this.value)">
                
                <div class="row"><span>åµæ¸¬å€åŸŸ:</span><span id="detectionAreaValue">å…¨ç•«é¢</span></div>
                <select id="detectionAreaSelect" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 5px; margin: 10px 0;" onchange="updateDetectionArea(this.value)">
                    <option value="full">å…¨ç•«é¢</option>
                    <option value="center">ä¸­å¤®å€åŸŸ</option>
                    <option value="top">ä¸ŠåŠéƒ¨</option>
                    <option value="bottom">ä¸‹åŠéƒ¨</option>
                    <option value="left">å·¦åŠéƒ¨</option>
                    <option value="right">å³åŠéƒ¨</option>
                </select>
                
                <div class="row">
                    <span>å‹•æ…‹åµæ¸¬:</span>
                    <input type="checkbox" id="motionDetection" checked onchange="updateMotionDetection(this.checked)">
                    <span id="motionStatus">âœ… å•Ÿç”¨</span>
                </div>
                
                <h3 style="margin-top: 20px;">ğŸ“¹ éŒ„è£½è¨­å®š</h3>
                <div class="row">
                    <span>éŒ„éŸ³å“è³ª:</span>
                    <select id="audioQualitySelect" style="padding: 5px; background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 5px;" onchange="updateAudioQuality(this.value)">
                        <option value="low">ä½ (22kHz)</option>
                        <option value="medium" selected>ä¸­ (44kHz)</option>
                        <option value="high">é«˜ (48kHz)</option>
                    </select>
                </div>
                
                <div class="row"><span>æœ€å¤§éŒ„è£½æ™‚é–“:</span><span id="maxRecordingTimeValue">30 ç§’</span></div>
                <input type="range" id="maxRecordingTimeSlider" style="width: 100%; margin: 10px 0;" min="10" max="300" value="30" oninput="updateMaxRecordingTime(this.value)">
                
                <div class="row">
                    <span>è‡ªå‹•éŒ„è£½:</span>
                    <input type="checkbox" id="autoRecording" checked onchange="updateAutoRecording(this.checked)">
                    <span id="autoRecordingStatus">âœ… å•Ÿç”¨</span>
                </div>
                
                <div class="row">
                    <span>åŒæ™‚éŒ„éŸ³éŒ„å½±:</span>
                    <input type="checkbox" id="recordBoth" onchange="updateRecordBoth(this.checked)">
                    <span id="recordBothStatus">âŒ é—œé–‰</span>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="resetSettings()">ğŸ”„ é‡ç½®è¨­å®š</button>
                    <button class="btn" onclick="exportSettings()" style="background: #27ae60;">ğŸ“¤ åŒ¯å‡ºè¨­å®š</button>
                </div>
            </div>
        </div>
        
        <div id="files" class="content hidden">
            <h2 style="text-align: center; margin-bottom: 20px;">ğŸ“ éŒ„è£½æª”æ¡ˆ</h2>
            <div class="status">
                <div class="row"><span>ğŸ“Š æª”æ¡ˆæ•¸:</span><span>3 å€‹</span></div>
                <div class="row"><span>ğŸ’¾ ç©ºé–“:</span><span>156 MB / 2 GB</span></div>
            </div>
            <div class="grid">
                <div class="card">
                    <span class="icon">ğŸµ</span>
                    <h4>éŸ³é »_143022.aac</h4>
                    <p>30ç§’ | 2.3MB</p>
                    <button class="btn" style="font-size: 0.8em; padding: 8px 16px;">â–¶ï¸ æ’­æ”¾</button>
                </div>
                <div class="card">
                    <span class="icon">ğŸ“¹</span>
                    <h4>è¦–é »_142015.mp4</h4>
                    <p>45ç§’ | 12.7MB</p>
                    <button class="btn" style="font-size: 0.8em; padding: 8px 16px;">â–¶ï¸ æ’­æ”¾</button>
                </div>
                <div class="card">
                    <span class="icon">ğŸ¬</span>
                    <h4>å®Œæ•´_141230.mp4</h4>
                    <p>1:23 | 28.9MB</p>
                    <button class="btn" style="font-size: 0.8em; padding: 8px 16px;">â–¶ï¸ æ’­æ”¾</button>
                </div>
            </div>
        </div>
        
        <div id="models" class="content hidden">
            <h2 style="text-align: center; margin-bottom: 20px;">ğŸ¤– AIæ¨¡å‹ç®¡ç†</h2>
            <div class="status">
                <div class="row"><span>ğŸ”„ æœ€å¾Œæ›´æ–°:</span><span id="lastUpdateTime">2025-01-07 14:30</span></div>
                <div class="row"><span>ğŸ“¡ é€£ç·šç‹€æ…‹:</span><span id="connectionStatus" style="color: #27ae60;">âœ… å·²é€£ç·š</span></div>
                <div class="row"><span>ğŸ¯ è‡ªå‹•æ›´æ–°:</span><input type="checkbox" id="autoUpdate" checked onchange="updateAutoUpdate(this.checked)"> <span id="autoUpdateStatus">âœ… å•Ÿç”¨</span></div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn" onclick="checkForUpdates()" id="checkUpdatesBtn">ğŸ” æª¢æŸ¥æ›´æ–°</button>
                <button class="btn" onclick="downloadAllModels()" style="background: #27ae60;">ğŸ“¥ ä¸‹è¼‰å…¨éƒ¨</button>
            </div>
            
            <div class="grid" id="modelsGrid">
                <div class="card">
                    <span class="icon">ğŸµ</span>
                    <h4>è²éŸ³è­˜åˆ¥æ¨¡å‹</h4>
                    <p><strong>ç‰ˆæœ¬:</strong> <span id="audioModelVersion">v2.3.1</span></p>
                    <p><strong>ç‹€æ…‹:</strong> <span id="audioModelStatus" style="color: #27ae60;">âœ… å·²è¼‰å…¥</span></p>
                    <p><strong>å¤§å°:</strong> <span id="audioModelSize">15.2 MB</span></p>
                    <p><strong>æº–ç¢ºç‡:</strong> <span id="audioModelAccuracy">94.7%</span></p>
                    <div style="margin: 10px 0;">
                        <div style="background: rgba(255,255,255,0.2); border-radius: 10px; height: 8px;">
                            <div style="background: #27ae60; height: 100%; border-radius: 10px; width: 95%;"></div>
                        </div>
                    </div>
                    <button class="btn" onclick="updateModel('audio')" style="font-size: 0.8em; padding: 8px 16px;">ğŸ”„ æ›´æ–°æ¨¡å‹</button>
                    <button class="btn" onclick="testModel('audio')" style="font-size: 0.8em; padding: 8px 16px; background: #3742fa;">ğŸ§ª æ¸¬è©¦</button>
                </div>
                
                <div class="card">
                    <span class="icon">ğŸ‘ï¸</span>
                    <h4>è¦–è¦ºåˆ†ææ¨¡å‹</h4>
                    <p><strong>ç‰ˆæœ¬:</strong> <span id="visualModelVersion">v1.8.5</span></p>
                    <p><strong>ç‹€æ…‹:</strong> <span id="visualModelStatus" style="color: #27ae60;">âœ… å·²è¼‰å…¥</span></p>
                    <p><strong>å¤§å°:</strong> <span id="visualModelSize">23.7 MB</span></p>
                    <p><strong>æº–ç¢ºç‡:</strong> <span id="visualModelAccuracy">91.3%</span></p>
                    <div style="margin: 10px 0;">
                        <div style="background: rgba(255,255,255,0.2); border-radius: 10px; height: 8px;">
                            <div style="background: #27ae60; height: 100%; border-radius: 10px; width: 91%;"></div>
                        </div>
                    </div>
                    <button class="btn" onclick="updateModel('visual')" style="font-size: 0.8em; padding: 8px 16px;">ğŸ”„ æ›´æ–°æ¨¡å‹</button>
                    <button class="btn" onclick="testModel('visual')" style="font-size: 0.8em; padding: 8px 16px; background: #3742fa;">ğŸ§ª æ¸¬è©¦</button>
                </div>
                
                <div class="card">
                    <span class="icon">ğŸ§ </span>
                    <h4>æ·±åº¦å­¸ç¿’æ ¸å¿ƒ</h4>
                    <p><strong>ç‰ˆæœ¬:</strong> <span id="coreModelVersion">v3.1.2</span></p>
                    <p><strong>ç‹€æ…‹:</strong> <span id="coreModelStatus" style="color: #27ae60;">âœ… å·²è¼‰å…¥</span></p>
                    <p><strong>å¤§å°:</strong> <span id="coreModelSize">45.1 MB</span></p>
                    <p><strong>æ•ˆèƒ½:</strong> <span id="coreModelPerformance">å„ªç§€</span></p>
                    <div style="margin: 10px 0;">
                        <div style="background: rgba(255,255,255,0.2); border-radius: 10px; height: 8px;">
                            <div style="background: #27ae60; height: 100%; border-radius: 10px; width: 98%;"></div>
                        </div>
                    </div>
                    <button class="btn" onclick="updateModel('core')" style="font-size: 0.8em; padding: 8px 16px;">ğŸ”„ æ›´æ–°æ¨¡å‹</button>
                    <button class="btn" onclick="optimizeModel('core')" style="font-size: 0.8em; padding: 8px 16px; background: #ff6b6b;">âš¡ æœ€ä½³åŒ–</button>
                </div>
                
                <div class="card">
                    <span class="icon">ğŸ”§</span>
                    <h4>æ¨¡å‹ç®¡ç†å·¥å…·</h4>
                    <p><strong>ç·©å­˜ç©ºé–“:</strong> <span id="cacheSize">84.0 MB / 200 MB</span></p>
                    <p><strong>æ›´æ–°é »ç‡:</strong> <span id="updateFrequency">æ¯é€±æª¢æŸ¥</span></p>
                    <p><strong>å‚™ä»½ç‹€æ…‹:</strong> <span id="backupStatus" style="color: #27ae60;">âœ… å·²å‚™ä»½</span></p>
                    <div style="margin: 15px 0;">
                        <button class="btn" onclick="clearCache()" style="font-size: 0.8em; padding: 8px 16px; background: #ff4757;">ğŸ—‘ï¸ æ¸…é™¤ç·©å­˜</button>
                        <button class="btn" onclick="backupModels()" style="font-size: 0.8em; padding: 8px 16px; background: #2ed573;">ğŸ’¾ å‚™ä»½æ¨¡å‹</button>
                    </div>
                </div>
            </div>
            
            <div class="status" style="margin-top: 20px;">
                <h3>ğŸ“Š æ¨¡å‹æ•ˆèƒ½çµ±è¨ˆ</h3>
                <div class="row"><span>è²éŸ³åµæ¸¬æˆåŠŸç‡:</span><span id="audioSuccessRate">94.7%</span></div>
                <div class="row"><span>è¦–è¦ºè­˜åˆ¥æº–ç¢ºåº¦:</span><span id="visualAccuracyRate">91.3%</span></div>
                <div class="row"><span>å¹³å‡è™•ç†æ™‚é–“:</span><span id="avgProcessTime">0.3 ç§’</span></div>
                <div class="row"><span>ç¸½è™•ç†æ¬¡æ•¸:</span><span id="totalProcessCount">1,247 æ¬¡</span></div>
            </div>
        </div>
        
        <p style="text-align: center; margin-top: 30px; opacity: 0.7; font-size: 0.9em;">
            ç‰ˆæœ¬ v1.0.16 | è¼•é‡ç´šWebæ‡‰ç”¨ | 512MB RAMæœ€ä½³åŒ–
        </p>
    </div>
    
    <script>
        let recording = false, time = 0, interval, mediaRecorder, recordedChunks = [], stream;
        let recordingFiles = JSON.parse(localStorage.getItem('tcldcam_files') || '[]');
        
        // Auto detection variables
        let audioDetectionActive = false;
        let visualDetectionActive = false;
        let audioContext, analyser, microphone, dataArray;
        let videoElement, canvas, canvasContext;
        let lastFrameData = null;
        let detectionSettings = {
            audioThreshold: 50,
            audioDuration: 2,
            audioAutoTrigger: true,
            visualSensitivity: 50,
            detectionArea: 'full',
            motionDetection: true,
            autoRecording: true,
            recordBoth: false
        };
        
        function show(tab) {
            document.querySelectorAll('.content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(tab).classList.remove('hidden');
            event.target.classList.add('active');
            
            if (tab === 'files') {
                updateFilesList();
            }
        }
        
        async function toggle() {
            const btn = document.getElementById('recordBtn');
            const status = document.getElementById('status');
            
            if (!audioDetectionActive && !visualDetectionActive) {
                // Start auto detection
                try {
                    await startAutoDetection();
                    btn.textContent = 'â¹ï¸ åœæ­¢åµæ¸¬';
                    btn.classList.add('active');
                    status.textContent = 'ğŸ‘ï¸ğŸµ è‡ªå‹•åµæ¸¬ä¸­';
                    console.log('âœ… è‡ªå‹•åµæ¸¬å·²å•Ÿå‹•');
                } catch (error) {
                    console.log('âš ï¸ æ¬Šé™è¢«æ‹’çµ•ï¼Œä½¿ç”¨æ¨¡æ“¬æ¨¡å¼');
                    startSimulatedDetection();
                    btn.textContent = 'â¹ï¸ åœæ­¢åµæ¸¬';
                    btn.classList.add('active');
                    status.textContent = 'ğŸ‘ï¸ğŸµ æ¨¡æ“¬åµæ¸¬ä¸­';
                }
            } else {
                // Stop auto detection
                stopAutoDetection();
                btn.textContent = 'ğŸ¤ é–‹å§‹åµæ¸¬';
                btn.classList.remove('active');
                status.textContent = 'å¾…æ©Ÿä¸­';
                console.log('â¹ï¸ è‡ªå‹•åµæ¸¬å·²åœæ­¢');
            }
        }
        
        async function startAutoDetection() {
            // Request permissions for audio and video
            const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const videoStream = await navigator.mediaDevices.getUserMedia({ video: true });
            
            // Setup audio detection
            if (detectionSettings.audioAutoTrigger) {
                setupAudioDetection(audioStream);
            }
            
            // Setup visual detection
            if (detectionSettings.motionDetection) {
                setupVisualDetection(videoStream);
            }
            
            stream = audioStream; // Keep reference for cleanup
            audioDetectionActive = true;
            visualDetectionActive = true;
        }
        
        function setupAudioDetection(audioStream) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            microphone = audioContext.createMediaStreamSource(audioStream);
            
            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);
            
            microphone.connect(analyser);
            
            // Start audio monitoring
            monitorAudio();
        }
        
        function setupVisualDetection(videoStream) {
            // Create hidden video element for analysis
            videoElement = document.createElement('video');
            videoElement.srcObject = videoStream;
            videoElement.play();
            videoElement.style.display = 'none';
            document.body.appendChild(videoElement);
            
            // Create canvas for frame analysis
            canvas = document.createElement('canvas');
            canvas.width = 320; // Lower resolution for performance
            canvas.height = 240;
            canvasContext = canvas.getContext('2d');
            
            // Start visual monitoring
            videoElement.onloadedmetadata = () => {
                monitorVisual();
            };
        }
        
        function monitorAudio() {
            if (!audioDetectionActive) return;
            
            analyser.getByteFrequencyData(dataArray);
            
            // Calculate average volume
            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) {
                sum += dataArray[i];
            }
            const averageVolume = sum / dataArray.length;
            
            // Update volume display
            document.getElementById('volume').textContent = `${Math.floor(averageVolume * 0.4)} dB`;
            
            // Check if volume exceeds threshold
            if (averageVolume > detectionSettings.audioThreshold * 2.55) { // Convert to 0-255 scale
                triggerAudioDetection(averageVolume);
            }
            
            // Continue monitoring
            requestAnimationFrame(monitorAudio);
        }
        
        function monitorVisual() {
            if (!visualDetectionActive || !videoElement) return;
            
            // Capture current frame
            canvasContext.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            const currentFrameData = canvasContext.getImageData(0, 0, canvas.width, canvas.height);
            
            if (lastFrameData) {
                // Calculate motion between frames
                const motionLevel = calculateMotion(lastFrameData, currentFrameData);
                
                // Update visual display
                const visualStates = ['åµæ¸¬ä¸­', 'åˆ†æç•«é¢', 'æ¯”å°å¹€æ•¸'];
                document.getElementById('visual').textContent = visualStates[Math.floor(Math.random() * 3)];
                
                // Check if motion exceeds sensitivity threshold
                if (motionLevel > (detectionSettings.visualSensitivity / 100) * 50) {
                    triggerVisualDetection(motionLevel);
                }
            }
            
            lastFrameData = currentFrameData;
            
            // Continue monitoring (30 FPS)
            setTimeout(monitorVisual, 33);
        }
        
        function calculateMotion(prevFrame, currFrame) {
            let totalDifference = 0;
            const pixels = prevFrame.data.length;
            
            for (let i = 0; i < pixels; i += 4) {
                // Calculate RGB difference
                const rDiff = Math.abs(prevFrame.data[i] - currFrame.data[i]);
                const gDiff = Math.abs(prevFrame.data[i + 1] - currFrame.data[i + 1]);
                const bDiff = Math.abs(prevFrame.data[i + 2] - currFrame.data[i + 2]);
                
                totalDifference += (rDiff + gDiff + bDiff) / 3;
            }
            
            return (totalDifference / (pixels / 4)) / 255 * 100; // Normalize to 0-100
        }
        
        function triggerAudioDetection(volume) {
            const status = document.getElementById('status');
            status.textContent = `ğŸµ éŸ³é »è§¸ç™¼! (${Math.floor(volume * 0.4)} dB)`;
            console.log(`ğŸµ éŸ³é »åµæ¸¬è§¸ç™¼: ${Math.floor(volume * 0.4)} dB`);
            
            if (detectionSettings.autoRecording && !recording) {
                startTriggeredRecording('audio', volume);
            }
            
            // Reset status after 3 seconds
            setTimeout(() => {
                if (audioDetectionActive) {
                    status.textContent = 'ğŸ‘ï¸ğŸµ è‡ªå‹•åµæ¸¬ä¸­';
                }
            }, 3000);
        }
        
        function triggerVisualDetection(motionLevel) {
            const status = document.getElementById('status');
            status.textContent = `ğŸ‘ï¸ è¦–è¦ºè§¸ç™¼! (å‹•æ…‹: ${motionLevel.toFixed(1)}%)`;
            console.log(`ğŸ‘ï¸ è¦–è¦ºåµæ¸¬è§¸ç™¼: å‹•æ…‹ç­‰ç´š ${motionLevel.toFixed(1)}%`);
            
            if (detectionSettings.autoRecording && !recording) {
                startTriggeredRecording('visual', motionLevel);
            }
            
            // Reset status after 3 seconds
            setTimeout(() => {
                if (visualDetectionActive) {
                    status.textContent = 'ğŸ‘ï¸ğŸµ è‡ªå‹•åµæ¸¬ä¸­';
                }
            }, 3000);
        }
        
        async function startTriggeredRecording(triggerType, triggerValue) {
            if (recording) return; // Already recording
            
            try {
                // Use existing stream or request new one
                if (!stream) {
                    stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: true, 
                        video: detectionSettings.recordBoth 
                    });
                }
                
                mediaRecorder = new MediaRecorder(stream);
                recordedChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    saveTriggeredRecording(triggerType, triggerValue);
                };
                
                mediaRecorder.start();
                recording = true;
                time = 0;
                interval = setInterval(updateDisplay, 1000);
                
                console.log(`âœ… è‡ªå‹•éŒ„è£½é–‹å§‹ (è§¸ç™¼: ${triggerType})`);
                
                // Auto-stop recording after duration
                setTimeout(() => {
                    if (recording) {
                        stopTriggeredRecording();
                    }
                }, detectionSettings.audioDuration * 1000);
                
            } catch (error) {
                console.error('éŒ„è£½å¤±æ•—:', error);
            }
        }
        
        function stopTriggeredRecording() {
            if (!recording) return;
            
            recording = false;
            clearInterval(interval);
            
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
            
            console.log('â¹ï¸ è‡ªå‹•éŒ„è£½çµæŸ');
        }
        
        function saveTriggeredRecording(triggerType, triggerValue) {
            const blob = new Blob(recordedChunks, { type: 'audio/webm' });
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const triggerText = triggerType === 'audio' ? `éŸ³é »${Math.floor(triggerValue * 0.4)}dB` : `è¦–è¦º${triggerValue.toFixed(1)}%`;
            const fileName = `è‡ªå‹•_${triggerText}_${timestamp.substring(11,19)}.webm`;
            
            const reader = new FileReader();
            reader.onloadend = () => {
                const fileData = {
                    id: Date.now(),
                    name: fileName,
                    type: detectionSettings.recordBoth ? 'video' : 'audio',
                    duration: time,
                    size: blob.size,
                    data: reader.result,
                    timestamp: new Date().toLocaleString('zh-TW'),
                    triggerType: `${triggerType === 'audio' ? 'ğŸµ' : 'ğŸ‘ï¸'} ${triggerText}è§¸ç™¼`,
                    autoRecorded: true
                };
                
                recordingFiles.unshift(fileData);
                if (recordingFiles.length > 10) {
                    recordingFiles = recordingFiles.slice(0, 10);
                }
                
                localStorage.setItem('tcldcam_files', JSON.stringify(recordingFiles));
                console.log(`âœ… è‡ªå‹•éŒ„è£½ä¿å­˜: ${fileName} (${blob.size} bytes)`);
                
                // Show notification
                showNotification(`ğŸ“¹ è‡ªå‹•éŒ„è£½å®Œæˆ\n${fileName}\næ™‚é•·: ${formatDuration(time)}`);
            };
            reader.readAsDataURL(blob);
        }
        
        function startSimulatedDetection() {
            audioDetectionActive = true;
            visualDetectionActive = true;
            
            // Simulate random detections
            const simulateDetection = () => {
                if (!audioDetectionActive) return;
                
                // Random audio detection (10% chance every 5 seconds)
                if (Math.random() < 0.1) {
                    const fakeVolume = Math.random() * 40 + 60; // 60-100 range
                    triggerAudioDetection(fakeVolume);
                }
                
                // Random visual detection (8% chance every 5 seconds)
                if (Math.random() < 0.08) {
                    const fakeMotion = Math.random() * 30 + 60; // 60-90 range
                    triggerVisualDetection(fakeMotion);
                }
                
                // Continue simulation
                setTimeout(simulateDetection, 5000);
            };
            
            simulateDetection();
        }
        
        function stopAutoDetection() {
            audioDetectionActive = false;
            visualDetectionActive = false;
            
            // Clean up audio context
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            
            // Clean up video element
            if (videoElement) {
                videoElement.srcObject?.getTracks().forEach(track => track.stop());
                videoElement.remove();
                videoElement = null;
            }
            
            // Clean up stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            // Stop any ongoing recording
            if (recording) {
                stopTriggeredRecording();
            }
            
            lastFrameData = null;
        }
        
        function showNotification(message) {
            // Simple alert for now (could be enhanced with custom notification UI)
            if (Notification && Notification.permission === 'granted') {
                new Notification('TCLDCAM è‡ªå‹•åµæ¸¬', {
                    body: message,
                    icon: 'ğŸ¥'
                });
            } else {
                console.log(`ğŸ“¢ é€šçŸ¥: ${message}`);
            }
        }
        
        // æ‰‹æ©Ÿç‰ˆé©é…æª¢æŸ¥
        function checkMobileCompatibility() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            console.log(`ğŸ“± è¨­å‚™æª¢æ¸¬: ${isMobile ? 'ç§»å‹•è¨­å‚™' : 'æ¡Œé¢è¨­å‚™'}`);
            if (isIOS) console.log('ğŸ iOS è¨­å‚™');
            if (isAndroid) console.log('ğŸ¤– Android è¨­å‚™');
            
            // æª¢æŸ¥é—œéµ API æ”¯æŒ
            const hasMediaDevices = !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
            const hasAudioContext = !!(window.AudioContext || window.webkitAudioContext);
            const hasNotifications = !!window.Notification;
            
            console.log(`ğŸ¤ åª’é«”è¨­å‚™ API: ${hasMediaDevices ? 'âœ…' : 'âŒ'}`);
            console.log(`ğŸ”Š éŸ³é »ä¸Šä¸‹æ–‡ API: ${hasAudioContext ? 'âœ…' : 'âŒ'}`);
            console.log(`ğŸ”” é€šçŸ¥ API: ${hasNotifications ? 'âœ…' : 'âŒ'}`);
            
            // æ‰‹æ©Ÿç‰ˆç‰¹æ®Šè™•ç†
            if (isMobile) {
                // ç¦ç”¨è¦–å£ç¸®æ”¾
                const viewport = document.querySelector('meta[name="viewport"]');
                if (viewport) {
                    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
                }
                
                // iOS Safari ç‰¹æ®Šè™•ç†
                if (isIOS) {
                    // é˜²æ­¢é é¢æ»¾å‹•æ™‚åœ°å€æ¬„æ¶ˆå¤±é€ æˆçš„é«˜åº¦è®ŠåŒ–
                    document.body.style.height = '100vh';
                    document.body.style.overflow = 'hidden';
                    
                    // æ·»åŠ  iOS ç‹€æ…‹æ¬„é©é…
                    document.body.style.paddingTop = 'env(safe-area-inset-top)';
                    document.body.style.paddingBottom = 'env(safe-area-inset-bottom)';
                }
                
                // è§¸æ§åé¥‹å„ªåŒ–
                document.addEventListener('touchstart', function(){}, {passive: true});
            }
            
            return {
                isMobile,
                isIOS,
                isAndroid,
                hasMediaDevices,
                hasAudioContext,
                hasNotifications
            };
        }
        
        // æ‰‹æ©Ÿç‰ˆéŸ³é »æ¬Šé™è™•ç†
        async function requestMobilePermissions() {
            const compatibility = checkMobileCompatibility();
            
            if (compatibility.isMobile) {
                try {
                    // æ‰‹æ©Ÿç‰ˆéœ€è¦ç”¨æˆ¶æ‰‹å‹¢è§¸ç™¼
                    console.log('ğŸ“± æ‰‹æ©Ÿç‰ˆæ¬Šé™è«‹æ±‚æº–å‚™ä¸­...');
                    
                    // å»¶é²è«‹æ±‚ï¼Œç­‰å¾…ç”¨æˆ¶äº¤äº’
                    document.addEventListener('click', async function requestOnFirstClick() {
                        try {
                            const stream = await navigator.mediaDevices.getUserMedia({ 
                                audio: true, 
                                video: false // æ‰‹æ©Ÿç‰ˆå…ˆåªè«‹æ±‚éŸ³é »æ¬Šé™
                            });
                            console.log('âœ… æ‰‹æ©Ÿç‰ˆéŸ³é »æ¬Šé™ç²å–æˆåŠŸ');
                            stream.getTracks().forEach(track => track.stop()); // ç«‹å³åœæ­¢ä»¥é‡‹æ”¾è³‡æº
                            document.removeEventListener('click', requestOnFirstClick);
                        } catch (error) {
                            console.log('âš ï¸ æ‰‹æ©Ÿç‰ˆéŸ³é »æ¬Šé™è¢«æ‹’çµ•');
                        }
                    }, { once: true });
                    
                } catch (error) {
                    console.error('æ‰‹æ©Ÿç‰ˆæ¬Šé™åˆå§‹åŒ–å¤±æ•—:', error);
                }
            }
            
            // é€šçŸ¥æ¬Šé™
            if (Notification && Notification.permission === 'default') {
                setTimeout(() => {
                    Notification.requestPermission().then(permission => {
                        console.log(`ğŸ”” é€šçŸ¥æ¬Šé™: ${permission}`);
                    });
                }, 2000); // å»¶é²è«‹æ±‚é¿å…å¤ªçªå…€
            }
        }
        
        // æ‰‹æ©Ÿç‰ˆç‰¹æ®Šçš„è‡ªå‹•åµæ¸¬å•Ÿå‹•
        async function startMobileAutoDetection() {
            const compatibility = checkMobileCompatibility();
            
            if (!compatibility.hasMediaDevices) {
                console.log('ğŸ“± è¨­å‚™ä¸æ”¯æŒåª’é«”APIï¼Œä½¿ç”¨æ¨¡æ“¬æ¨¡å¼');
                startSimulatedDetection();
                return;
            }
            
            try {
                // æ‰‹æ©Ÿç‰ˆåˆ†æ­¥é©Ÿè«‹æ±‚æ¬Šé™
                const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                console.log('âœ… æ‰‹æ©Ÿç‰ˆéŸ³é »æ¬Šé™ç²å–æˆåŠŸ');
                
                // éŸ³é »åµæ¸¬
                if (detectionSettings.audioAutoTrigger) {
                    setupAudioDetection(audioStream);
                }
                
                // è¦–é »æ¬Šé™å–®ç¨è«‹æ±‚ï¼ˆå¯èƒ½è¢«æ‹’çµ•ï¼‰
                if (detectionSettings.motionDetection) {
                    try {
                        const videoStream = await navigator.mediaDevices.getUserMedia({ video: true });
                        console.log('âœ… æ‰‹æ©Ÿç‰ˆè¦–é »æ¬Šé™ç²å–æˆåŠŸ');
                        setupVisualDetection(videoStream);
                    } catch (videoError) {
                        console.log('âš ï¸ æ‰‹æ©Ÿç‰ˆè¦–é »æ¬Šé™è¢«æ‹’çµ•ï¼Œåƒ…ä½¿ç”¨éŸ³é »åµæ¸¬');
                    }
                }
                
                stream = audioStream;
                audioDetectionActive = true;
                visualDetectionActive = detectionSettings.motionDetection;
                
            } catch (error) {
                console.log('âš ï¸ æ‰‹æ©Ÿç‰ˆæ¬Šé™è¢«æ‹’çµ•ï¼Œä½¿ç”¨æ¨¡æ“¬æ¨¡å¼');
                startSimulatedDetection();
            }
        }
        
        // è¦†å¯«åŸæœ‰çš„è‡ªå‹•åµæ¸¬å‡½æ•¸ä»¥æ”¯æŒæ‰‹æ©Ÿç‰ˆ
        const originalStartAutoDetection = window.startAutoDetection;
        window.startAutoDetection = async function() {
            const compatibility = checkMobileCompatibility();
            if (compatibility.isMobile) {
                return await startMobileAutoDetection();
            } else {
                return await originalStartAutoDetection();
            }
        };
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            checkMobileCompatibility();
            requestMobilePermissions();
            console.log('ğŸ“± æ‰‹æ©Ÿç‰ˆé©é…åˆå§‹åŒ–å®Œæˆ');
        });
        
        function stopRecording() {
            recording = false;
            const btn = document.getElementById('recordBtn');
            const status = document.getElementById('status');
            
            btn.textContent = 'ğŸ¤ é–‹å§‹åµæ¸¬';
            btn.classList.remove('active');
            status.textContent = 'ğŸ’¾ ä¿å­˜ä¸­...';
            clearInterval(interval);
            
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                stream?.getTracks().forEach(track => track.stop());
            } else {
                // æ¨¡æ“¬æ¨¡å¼ä¿å­˜
                saveSimulatedRecording();
            }
            
            setTimeout(() => {
                status.textContent = 'å¾…æ©Ÿä¸­';
                document.getElementById('time').textContent = '00:00';
            }, 2000);
        }
        
        function saveRecording() {
            const blob = new Blob(recordedChunks, { type: 'audio/webm' });
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const fileName = `éŒ„éŸ³_${timestamp.substring(0,19)}.webm`;
            
            // è½‰æ›ç‚ºbase64ä¿å­˜åˆ°localStorage
            const reader = new FileReader();
            reader.onloadend = () => {
                const fileData = {
                    id: Date.now(),
                    name: fileName,
                    type: 'audio',
                    duration: time,
                    size: blob.size,
                    data: reader.result,
                    timestamp: new Date().toLocaleString('zh-TW'),
                    triggerType: 'æ‰‹å‹•éŒ„è£½'
                };
                
                recordingFiles.unshift(fileData);
                // é™åˆ¶æœ€å¤šä¿å­˜10å€‹æª”æ¡ˆ
                if (recordingFiles.length > 10) {
                    recordingFiles = recordingFiles.slice(0, 10);
                }
                
                localStorage.setItem('tcldcam_files', JSON.stringify(recordingFiles));
                console.log(`âœ… ä¿å­˜éŒ„éŸ³: ${fileName} (${blob.size} bytes)`);
            };
            reader.readAsDataURL(blob);
        }
        
        function saveSimulatedRecording() {
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const fileName = `æ¨¡æ“¬éŒ„éŸ³_${timestamp.substring(0,19)}.webm`;
            
            const fileData = {
                id: Date.now(),
                name: fileName,
                type: 'audio',
                duration: time,
                size: Math.floor(Math.random() * 500000) + 100000, // æ¨¡æ“¬æª”æ¡ˆå¤§å°
                data: 'data:audio/webm;base64,simulated', // æ¨¡æ“¬æ•¸æ“š
                timestamp: new Date().toLocaleString('zh-TW'),
                triggerType: 'æ¨¡æ“¬éŒ„è£½'
            };
            
            recordingFiles.unshift(fileData);
            if (recordingFiles.length > 10) {
                recordingFiles = recordingFiles.slice(0, 10);
            }
            
            localStorage.setItem('tcldcam_files', JSON.stringify(recordingFiles));
            console.log(`âœ… ä¿å­˜æ¨¡æ“¬éŒ„éŸ³: ${fileName}`);
        }
        
        function updateFilesList() {
            const filesGrid = document.querySelector('#files .grid');
            if (!filesGrid) return;
            
            if (recordingFiles.length === 0) {
                filesGrid.innerHTML = '<div class="card"><span class="icon">ğŸ“­</span><h4>æš«ç„¡éŒ„è£½æª”æ¡ˆ</h4><p>é–‹å§‹éŒ„è£½å¾Œæª”æ¡ˆå°‡é¡¯ç¤ºåœ¨é€™è£¡</p></div>';
                return;
            }
            
            filesGrid.innerHTML = recordingFiles.map(file => `
                <div class="card">
                    <span class="icon">${file.type === 'audio' ? 'ğŸµ' : 'ğŸ“¹'}</span>
                    <h4>${file.name}</h4>
                    <p>${formatDuration(file.duration)} | ${formatFileSize(file.size)}</p>
                    <p style="font-size: 0.8em; opacity: 0.8;">${file.timestamp}</p>
                    <button class="btn" style="font-size: 0.8em; padding: 8px 16px;" onclick="playFile(${file.id})">â–¶ï¸ æ’­æ”¾</button>
                    <button class="btn" style="font-size: 0.8em; padding: 8px 16px; background: #ff4757;" onclick="deleteFile(${file.id})">ğŸ—‘ï¸ åˆªé™¤</button>
                </div>
            `).join('');
            
            // æ›´æ–°çµ±è¨ˆ
            const totalSize = recordingFiles.reduce((sum, file) => sum + file.size, 0);
            document.querySelector('#files .status').innerHTML = `
                <div class="row"><span>ğŸ“Š æª”æ¡ˆæ•¸:</span><span>${recordingFiles.length} å€‹</span></div>
                <div class="row"><span>ğŸ’¾ ç©ºé–“:</span><span>${formatFileSize(totalSize)} / 2 GB</span></div>
            `;
        }
        
        function formatDuration(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            return `${min}:${sec.toString().padStart(2, '0')}`;
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        function playFile(id) {
            const file = recordingFiles.find(f => f.id === id);
            if (!file) return;
            
            if (file.data === 'data:audio/webm;base64,simulated') {
                alert('é€™æ˜¯æ¨¡æ“¬æª”æ¡ˆï¼Œç„¡æ³•æ’­æ”¾ã€‚è«‹å…è¨±éº¥å…‹é¢¨æ¬Šé™ä»¥éŒ„è£½çœŸå¯¦éŸ³é »ã€‚');
                return;
            }
            
            const audio = new Audio(file.data);
            audio.play().then(() => {
                console.log(`â–¶ï¸ æ’­æ”¾: ${file.name}`);
            }).catch(error => {
                console.error('æ’­æ”¾å¤±æ•—:', error);
                alert('æ’­æ”¾å¤±æ•—ï¼Œæª”æ¡ˆå¯èƒ½å·²æå£');
            });
        }
        
        function deleteFile(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æª”æ¡ˆå—ï¼Ÿ')) {
                recordingFiles = recordingFiles.filter(f => f.id !== id);
                localStorage.setItem('tcldcam_files', JSON.stringify(recordingFiles));
                updateFilesList();
                console.log('ğŸ—‘ï¸ æª”æ¡ˆå·²åˆªé™¤');
            }
        }
        
        function updateDisplay() {
            time++;
            const min = Math.floor(time / 60), sec = time % 60;
            document.getElementById('time').textContent = 
                `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            document.getElementById('volume').textContent = `${Math.floor(Math.random() * 40) + 30} dB`;
            const states = ['åµæ¸¬ä¸­', 'ç™¼ç¾å‹•æ…‹', 'åˆ†æä¸­'];
            document.getElementById('visual').textContent = states[Math.floor(Math.random() * 3)];
        }
        
        // Settings page functions
        function updateAudioThreshold(value) {
            document.getElementById('audioThresholdValue').textContent = `${value} dB`;
            detectionSettings.audioThreshold = parseInt(value);
            console.log(`ğŸµ éŸ³é »é–¾å€¼è¨­å®šç‚º: ${value} dB`);
        }
        
        function updateAudioDuration(value) {
            document.getElementById('audioDurationValue').textContent = `${value} ç§’`;
            detectionSettings.audioDuration = parseInt(value);
            console.log(`â±ï¸ éŸ³é »æŒçºŒæ™‚é–“è¨­å®šç‚º: ${value} ç§’`);
        }
        
        function updateAudioAutoTrigger(checked) {
            document.getElementById('audioAutoStatus').textContent = checked ? 'âœ… å•Ÿç”¨' : 'âŒ é—œé–‰';
            detectionSettings.audioAutoTrigger = checked;
            console.log(`ğŸ”„ éŸ³é »è‡ªå‹•è§¸ç™¼: ${checked ? 'å•Ÿç”¨' : 'é—œé–‰'}`);
        }
        
        function updateVisualSensitivity(value) {
            const levels = ['å¾ˆä½', 'ä½', 'ä¸­ä½', 'ä¸­ç­‰', 'ä¸­é«˜', 'é«˜', 'å¾ˆé«˜'];
            const level = levels[Math.floor(value / 14.3)] || 'ä¸­ç­‰';
            document.getElementById('visualSensitivityValue').textContent = level;
            detectionSettings.visualSensitivity = parseInt(value);
            console.log(`ğŸ‘ï¸ è¦–è¦ºéˆæ•åº¦è¨­å®šç‚º: ${level} (${value})`);
        }
        
        function updateDetectionArea(value) {
            const areas = {
                'full': 'å…¨ç•«é¢',
                'center': 'ä¸­å¤®å€åŸŸ',
                'top': 'ä¸ŠåŠéƒ¨',
                'bottom': 'ä¸‹åŠéƒ¨',
                'left': 'å·¦åŠéƒ¨',
                'right': 'å³åŠéƒ¨'
            };
            document.getElementById('detectionAreaValue').textContent = areas[value];
            detectionSettings.detectionArea = value;
            console.log(`ğŸ“ åµæ¸¬å€åŸŸè¨­å®šç‚º: ${areas[value]}`);
        }
        
        function updateMotionDetection(checked) {
            document.getElementById('motionStatus').textContent = checked ? 'âœ… å•Ÿç”¨' : 'âŒ é—œé–‰';
            detectionSettings.motionDetection = checked;
            console.log(`ğŸƒ å‹•æ…‹åµæ¸¬: ${checked ? 'å•Ÿç”¨' : 'é—œé–‰'}`);
        }
        
        function updateAudioQuality(value) {
            const qualities = { 'low': 'ä½ (22kHz)', 'medium': 'ä¸­ (44kHz)', 'high': 'é«˜ (48kHz)' };
            console.log(`ğŸ¼ éŸ³é »å“è³ªè¨­å®šç‚º: ${qualities[value]}`);
        }
        
        function updateMaxRecordingTime(value) {
            document.getElementById('maxRecordingTimeValue').textContent = `${value} ç§’`;
            console.log(`â° æœ€å¤§éŒ„è£½æ™‚é–“è¨­å®šç‚º: ${value} ç§’`);
        }
        
        function updateAutoRecording(checked) {
            document.getElementById('autoRecordingStatus').textContent = checked ? 'âœ… å•Ÿç”¨' : 'âŒ é—œé–‰';
            detectionSettings.autoRecording = checked;
            console.log(`ğŸ¬ è‡ªå‹•éŒ„è£½: ${checked ? 'å•Ÿç”¨' : 'é—œé–‰'}`);
        }
        
        function updateRecordBoth(checked) {
            document.getElementById('recordBothStatus').textContent = checked ? 'âœ… å•Ÿç”¨' : 'âŒ é—œé–‰';
            detectionSettings.recordBoth = checked;
            console.log(`ğŸ¥ğŸµ åŒæ™‚éŒ„éŸ³éŒ„å½±: ${checked ? 'å•Ÿç”¨' : 'é—œé–‰'}`);
        }
        
        function resetSettings() {
            if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è¨­å®šå—ï¼Ÿ')) {
                // Reset all sliders and checkboxes
                document.getElementById('audioThresholdSlider').value = 50;
                document.getElementById('audioDurationSlider').value = 2;
                document.getElementById('visualSensitivitySlider').value = 50;
                document.getElementById('maxRecordingTimeSlider').value = 30;
                document.getElementById('audioAutoTrigger').checked = true;
                document.getElementById('motionDetection').checked = true;
                document.getElementById('autoRecording').checked = true;
                document.getElementById('recordBoth').checked = false;
                document.getElementById('detectionAreaSelect').value = 'full';
                document.getElementById('audioQualitySelect').value = 'medium';
                
                // Update displays
                updateAudioThreshold(50);
                updateAudioDuration(2);
                updateVisualSensitivity(50);
                updateMaxRecordingTime(30);
                updateAudioAutoTrigger(true);
                updateMotionDetection(true);
                updateAutoRecording(true);
                updateRecordBoth(false);
                updateDetectionArea('full');
                
                console.log('ğŸ”„ è¨­å®šå·²é‡ç½®ç‚ºé è¨­å€¼');
                alert('âœ… è¨­å®šå·²é‡ç½®ç‚ºé è¨­å€¼');
            }
        }
        
        function exportSettings() {
            const settings = {
                audioThreshold: document.getElementById('audioThresholdSlider').value,
                audioDuration: document.getElementById('audioDurationSlider').value,
                audioAutoTrigger: document.getElementById('audioAutoTrigger').checked,
                visualSensitivity: document.getElementById('visualSensitivitySlider').value,
                detectionArea: document.getElementById('detectionAreaSelect').value,
                motionDetection: document.getElementById('motionDetection').checked,
                audioQuality: document.getElementById('audioQualitySelect').value,
                maxRecordingTime: document.getElementById('maxRecordingTimeSlider').value,
                autoRecording: document.getElementById('autoRecording').checked,
                recordBoth: document.getElementById('recordBoth').checked,
                exportTime: new Date().toLocaleString('zh-TW')
            };
            
            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `TCLDCAM_è¨­å®š_${new Date().toISOString().substring(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('ğŸ“¤ è¨­å®šå·²åŒ¯å‡º');
            alert('âœ… è¨­å®šæª”æ¡ˆå·²ä¸‹è¼‰');
        }
        
        // Models page functions
        function updateAutoUpdate(checked) {
            document.getElementById('autoUpdateStatus').textContent = checked ? 'âœ… å•Ÿç”¨' : 'âŒ é—œé–‰';
            console.log(`ğŸ¤– è‡ªå‹•æ›´æ–°: ${checked ? 'å•Ÿç”¨' : 'é—œé–‰'}`);
        }
        
        function checkForUpdates() {
            const btn = document.getElementById('checkUpdatesBtn');
            btn.textContent = 'ğŸ”„ æª¢æŸ¥ä¸­...';
            btn.disabled = true;
            
            // æ¨¡æ“¬æª¢æŸ¥æ›´æ–°
            setTimeout(() => {
                const hasUpdates = Math.random() > 0.5;
                if (hasUpdates) {
                    alert('ğŸ‰ ç™¼ç¾æ–°ç‰ˆæœ¬ï¼\n\nè²éŸ³è­˜åˆ¥æ¨¡å‹: v2.3.1 â†’ v2.3.2\nè¦–è¦ºåˆ†ææ¨¡å‹: v1.8.5 â†’ v1.8.6\n\né»æ“Šç¢ºå®šé–‹å§‹ä¸‹è¼‰æ›´æ–°ã€‚');
                    // Update version numbers
                    document.getElementById('audioModelVersion').textContent = 'v2.3.2';
                    document.getElementById('visualModelVersion').textContent = 'v1.8.6';
                } else {
                    alert('âœ… æ‰€æœ‰æ¨¡å‹å·²æ˜¯æœ€æ–°ç‰ˆæœ¬');
                }
                document.getElementById('lastUpdateTime').textContent = new Date().toLocaleString('zh-TW').substring(0,16);
                btn.textContent = 'ğŸ” æª¢æŸ¥æ›´æ–°';
                btn.disabled = false;
            }, 2000);
        }
        
        function downloadAllModels() {
            if (confirm('ç¢ºå®šè¦ä¸‹è¼‰æ‰€æœ‰æ¨¡å‹å—ï¼Ÿé€™å°‡éœ€è¦ç´„ 84MB çš„ç©ºé–“ã€‚')) {
                alert('ğŸ“¥ é–‹å§‹ä¸‹è¼‰æ‰€æœ‰æ¨¡å‹...\n\né è¨ˆéœ€è¦ 2-3 åˆ†é˜å®Œæˆ\nè«‹ä¿æŒç¶²è·¯é€£ç·šç©©å®š');
                console.log('ğŸ“¥ é–‹å§‹ä¸‹è¼‰æ‰€æœ‰AIæ¨¡å‹');
            }
        }
        
        function updateModel(type) {
            const models = {
                'audio': 'è²éŸ³è­˜åˆ¥æ¨¡å‹',
                'visual': 'è¦–è¦ºåˆ†ææ¨¡å‹', 
                'core': 'æ·±åº¦å­¸ç¿’æ ¸å¿ƒ'
            };
            
            if (confirm(`ç¢ºå®šè¦æ›´æ–°${models[type]}å—ï¼Ÿ`)) {
                alert(`ğŸ”„ æ­£åœ¨æ›´æ–°${models[type]}...\n\nä¸‹è¼‰é€²åº¦å°‡åœ¨æ§åˆ¶å°é¡¯ç¤º`);
                console.log(`ğŸ”„ é–‹å§‹æ›´æ–° ${models[type]}`);
                
                // Simulate update progress
                setTimeout(() => {
                    console.log(`âœ… ${models[type]} æ›´æ–°å®Œæˆ`);
                    alert(`âœ… ${models[type]} æ›´æ–°æˆåŠŸï¼`);
                }, 3000);
            }
        }
        
        function testModel(type) {
            const models = {
                'audio': 'è²éŸ³è­˜åˆ¥æ¨¡å‹',
                'visual': 'è¦–è¦ºåˆ†ææ¨¡å‹'
            };
            
            alert(`ğŸ§ª é–‹å§‹æ¸¬è©¦${models[type]}...\n\næ¸¬è©¦çµæœå°‡åœ¨ 5 ç§’å¾Œé¡¯ç¤º`);
            console.log(`ğŸ§ª æ¸¬è©¦ ${models[type]}`);
            
            setTimeout(() => {
                const accuracy = (Math.random() * 10 + 90).toFixed(1);
                const responseTime = (Math.random() * 0.5 + 0.1).toFixed(2);
                alert(`ğŸ“Š ${models[type]} æ¸¬è©¦çµæœ:\n\nâœ… æº–ç¢ºç‡: ${accuracy}%\nâš¡ éŸ¿æ‡‰æ™‚é–“: ${responseTime} ç§’\nğŸ¯ ç‹€æ…‹: æ­£å¸¸é‹è¡Œ`);
                
                // Update accuracy display
                if (type === 'audio') {
                    document.getElementById('audioModelAccuracy').textContent = `${accuracy}%`;
                    document.getElementById('audioSuccessRate').textContent = `${accuracy}%`;
                } else if (type === 'visual') {
                    document.getElementById('visualModelAccuracy').textContent = `${accuracy}%`;
                    document.getElementById('visualAccuracyRate').textContent = `${accuracy}%`;
                }
                document.getElementById('avgProcessTime').textContent = `${responseTime} ç§’`;
            }, 5000);
        }
        
        function optimizeModel(type) {
            if (confirm('æ¨¡å‹æœ€ä½³åŒ–å°‡é‡æ–°ç·¨è­¯æ¨¡å‹ä»¥æå‡æ•ˆèƒ½ï¼Œéç¨‹éœ€è¦ 3-5 åˆ†é˜ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
                alert('âš¡ é–‹å§‹æ¨¡å‹æœ€ä½³åŒ–...\n\né€™å€‹éç¨‹æœƒï¼š\nâ€¢ å£“ç¸®æ¨¡å‹å¤§å°\nâ€¢ æå‡æ¨ç†é€Ÿåº¦\nâ€¢ é™ä½è¨˜æ†¶é«”ä½¿ç”¨\n\nè«‹å‹¿é—œé–‰ç€è¦½å™¨');
                console.log('âš¡ é–‹å§‹æ·±åº¦å­¸ç¿’æ ¸å¿ƒæœ€ä½³åŒ–');
                
                setTimeout(() => {
                    alert('âœ… æ¨¡å‹æœ€ä½³åŒ–å®Œæˆï¼\n\næ”¹é€²é …ç›®ï¼š\nâ€¢ æ¨¡å‹å¤§å°: 45.1MB â†’ 38.7MB\nâ€¢ æ¨ç†é€Ÿåº¦: +23%\nâ€¢ è¨˜æ†¶é«”ä½¿ç”¨: -18%');
                    document.getElementById('coreModelSize').textContent = '38.7 MB';
                    document.getElementById('coreModelPerformance').textContent = 'å“è¶Š';
                }, 5000);
            }
        }
        
        function clearCache() {
            if (confirm('æ¸…é™¤ç·©å­˜å°‡åˆªé™¤æ‰€æœ‰è‡¨æ™‚æª”æ¡ˆï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
                alert('ğŸ—‘ï¸ æ­£åœ¨æ¸…é™¤ç·©å­˜...');
                console.log('ğŸ—‘ï¸ æ¸…é™¤æ¨¡å‹ç·©å­˜');
                
                setTimeout(() => {
                    document.getElementById('cacheSize').textContent = '12.3 MB / 200 MB';
                    alert('âœ… ç·©å­˜å·²æ¸…é™¤\n\né‡‹æ”¾ç©ºé–“: 71.7 MB');
                }, 2000);
            }
        }
        
        function backupModels() {
            if (confirm('å»ºç«‹æ¨¡å‹å‚™ä»½å°‡ä¿å­˜ç•¶å‰æ‰€æœ‰æ¨¡å‹åˆ°æœ¬åœ°å­˜å„²ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
                alert('ğŸ’¾ æ­£åœ¨å‚™ä»½æ¨¡å‹...\n\nå‚™ä»½é …ç›®ï¼š\nâ€¢ è²éŸ³è­˜åˆ¥æ¨¡å‹\nâ€¢ è¦–è¦ºåˆ†ææ¨¡å‹\nâ€¢ æ·±åº¦å­¸ç¿’æ ¸å¿ƒ\n\né è¨ˆéœ€è¦ 30 ç§’');
                console.log('ğŸ’¾ é–‹å§‹å‚™ä»½æ‰€æœ‰AIæ¨¡å‹');
                
                setTimeout(() => {
                    const timestamp = new Date().toLocaleString('zh-TW');
                    document.getElementById('backupStatus').textContent = `âœ… å·²å‚™ä»½ (${timestamp.substring(5,16)})`;
                    alert('âœ… æ¨¡å‹å‚™ä»½å®Œæˆï¼\n\nå‚™ä»½å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å„²\nå¯åœ¨æª”æ¡ˆç®¡ç†ä¸­æŸ¥çœ‹');
                }, 3000);
            }
        }
        
        setInterval(() => {
            if (!recording) {
                document.getElementById('volume').textContent = `${Math.floor(Math.random() * 20) + 15} dB`;
                // æ›´æ–°çµ±è¨ˆæ•¸æ“š
                const totalCount = parseInt(document.getElementById('totalProcessCount').textContent.replace(/[^0-9]/g, ''));
                if (totalCount && Math.random() > 0.95) { // 5% æ©Ÿç‡æ›´æ–°
                    document.getElementById('totalProcessCount').textContent = `${totalCount + 1} æ¬¡`;
                }
            }
        }, 3000);
        
        console.log('ğŸš€ TCLDCAM è¼•é‡ç´šæ‡‰ç”¨å·²è¼‰å…¥ (512MB RAMæœ€ä½³åŒ–)');
        console.log('âœ¨ æ‰€æœ‰UIåŠŸèƒ½å·²å®Œæ•´å¯¦ä½œ');
        console.log('ğŸ“± æ‰‹æ©Ÿç‰ˆè‡ªå‹•åµæ¸¬åŠŸèƒ½å·²å•Ÿç”¨');
    </script>
</body>
</html>